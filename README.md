# AprLoader
Репозиторий для размещения приложения AprLoader

## Системные требования
Данная утилита предназначена для загрузки АПР-параметров на комплексы, работающие с EPO 2.0 и New EPO. Проект AprLoader написан на .NET 6 с использованием Entity Framework Core и паттерна MVVM. Перед использованием необходимо обязательно сделать бэкап баз WGD и APR средствами SSMS. Для корректной работы приложения обязательным условием является наличие баз данных APR и WGD.

## Автоматическая загрузка
Автоматическая загрузка АПР-параметров завязана на файле настроек, который имеет формат xml и содержит в себе сопоставления рабочих мест с листами таблиц для конкретного детектора.
Для автоматической загрузки необходимо:

- Перейти на вкладку "Конфигурации APR"
- Выбрать excel-файл с АПР-параметрами, который мы хотим загрузить в базу данных
- По названию excel-файла будет определено имя детектора, и, при наличии подходящих конфигураций, будет выведен на экран их список
- При выборе конфигурации в правом окне "Сопоставления" отображается список рабочих мест, соответствующий рабочему месту выбранный детектор и соответствующие сопоставления
- В режиме редактирования возможно добавление новых или удаление существующих сопоставлений, изменение детектора. Каждое измененное сопоставление необходимо сохранить, после завершения редактирования необходимо целиком сохранить кофигурацию. При создании новой конфигурации необходимо выбрать вариант поставки из выпадающего списка, после чего ввести понятное описание и сохранить конфигурацию
- Для добавления сопоставлений в новую конфигурацию необходимо выбрать ее и перейти в режим редактирования
- Для удаления конфигурации необходимо выбрать ее, после чего нажать кнопку "Удалить"

Важно: если вы загружаете excel-файл, для которого ранее не было создано конфигураций, необходимо перед запуском приложения открыть файл AutoLoadingSettings.xml (путь: ...bin\Debug\net6.0-windows\AutoLoadingSettings.xml) и добавить предпоследней строкой строку. Если вы создали конфигурацию, которая не является тестовой и потребуется другим пользователем, необходимо после завершения работы с программой передать файл AutoLoadingSettings.xml отделу разработки.

## Консольная версия автоматической загрузки
Консольная версия разработана и внедрена в установщик ЕПО. Для запуска консольной версии необходимо:

- Запустить консоль и перейти к папке '...bin\Debug\net6.0-windows'
- Ввести команду 'start AprLoaderNew.exe console'
- Программа считает все файлы по пути 'D:\' расширения 'xlsx' и предложит выбрать один из них
- При наличии подходящих конфигураций будет предложен выбор одной из них
- При выборе конфигурации будут показаны сопоставления, которые она содержит. Можно загрузить конфигурацию или вернуться на предыдущий шаг
- При загрузке конфигурации на экран отобразится прогресс загрузки в процентах, после чего будет выведено сообщение о статусе загрузки
- После окончания загрузки можно выйти из приложения или вернуться к выбору конфигураций
